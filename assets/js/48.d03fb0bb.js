(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{441:function(t,_,v){"use strict";v.r(_);var e=v(44),d=Object(e.a)({},(function(){var t=this,_=t.$createElement,v=t._self._c||_;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"审核规则"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#审核规则"}},[t._v("#")]),t._v(" 审核规则")]),t._v(" "),v("p",[t._v("了解和熟悉下面的审核规则，可以知道goinception大概做了哪些操作。")]),t._v(" "),v("p",[v("strong",[t._v("说明")]),t._v("：下面所列出来的规则，不一定能覆盖所有goinception当前已经实现的功能，具体包括什么规则，还需要在使用过程中总结，发现，同时可以结合配置参数来详细了解这些规则。")]),t._v(" "),v("h2",{attrs:{id:"支持语法"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#支持语法"}},[t._v("#")]),t._v(" 支持语法")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("语法")]),t._v(" "),v("th",[t._v("说明")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("use db")]),t._v(" "),v("td",[t._v("会检查这个库是否存在，需要连接到线上服务器来判断。")])]),t._v(" "),v("tr",[v("td",[t._v("set names charset")]),t._v(" "),v("td",[t._v("仅支持这一个SET命令")])]),t._v(" "),v("tr",[v("td",[t._v("create database")]),t._v(" "),v("td",[t._v("建库")])]),t._v(" "),v("tr",[v("td",[t._v("create table")]),t._v(" "),v("td",[t._v("建表")])]),t._v(" "),v("tr",[v("td",[t._v("alter table")]),t._v(" "),v("td",[t._v("修改表")])]),t._v(" "),v("tr",[v("td",[t._v("drop table")]),t._v(" "),v("td",[t._v("删除表")])]),t._v(" "),v("tr",[v("td",[t._v("truncate table")]),t._v(" "),v("td",[t._v("清空表")])]),t._v(" "),v("tr",[v("td",[t._v("insert")]),t._v(" "),v("td",[t._v("插入语句(包括多值插入和查询插入)")])]),t._v(" "),v("tr",[v("td",[t._v("update")]),t._v(" "),v("td",[t._v("更新语句(包括多表关联更新)")])]),t._v(" "),v("tr",[v("td",[t._v("delete")]),t._v(" "),v("td",[t._v("删除语句(包括多表关联删除)")])]),t._v(" "),v("tr",[v("td",[t._v("inception命令集")]),t._v(" "),v("td",[t._v("查看进程,osc进程,查看/设置变量及审核级别等")])]),t._v(" "),v("tr",[v("td",[t._v("用户管理命令")]),t._v(" "),v("td",[t._v("开启安全登陆后,可以创建/修改/删除用户,以及授权/收回和设置密码")])])])]),t._v(" "),v("h2",{attrs:{id:"ddl操作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#ddl操作"}},[t._v("#")]),t._v(" DDL操作")]),t._v(" "),v("h3",{attrs:{id:"create-table"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#create-table"}},[t._v("#")]),t._v(" create table")]),t._v(" "),v("h4",{attrs:{id:"表属性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#表属性"}},[t._v("#")]),t._v(" 表属性")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("这个表不存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("当前库存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("对于"),v("code",[t._v("create table like")]),t._v("，会检查like的老表是不是存在。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("表名、列名、索引名的长度不大于64个字节")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("对象名必须大写")]),t._v(" "),v("td",[t._v("check_identifier_upper")])]),t._v(" "),v("tr",[v("td",[t._v("对象名允许字符[a-zA-Z0-9_]")]),t._v(" "),v("td",[t._v("check_identifier")])]),t._v(" "),v("tr",[v("td",[t._v("对象名不能使用关键字")]),t._v(" "),v("td",[t._v("enable_identifer_keyword")])]),t._v(" "),v("tr",[v("td",[v("s",[t._v("如果建立的是临时表，则必须要以tmp为前缀")]),t._v(" "),v("code",[t._v("不支持临时表!")])]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("字符集限制")]),t._v(" "),v("td",[t._v("enable_set_charset,support_charset")])]),t._v(" "),v("tr",[v("td",[t._v("排序规则限制")]),t._v(" "),v("td",[t._v("enable_set_collation,support_collation")])]),t._v(" "),v("tr",[v("td",[t._v("存储引擎限制")]),t._v(" "),v("td",[t._v("enable_set_engine,support_engine")])]),t._v(" "),v("tr",[v("td",[t._v("不能建立为分区表")]),t._v(" "),v("td",[t._v("enable_partition_table")])]),t._v(" "),v("tr",[v("td",[t._v("只能有一个自增列")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("只能有一个主键")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("表要有主键")]),t._v(" "),v("td",[t._v("check_primary_key")])]),t._v(" "),v("tr",[v("td",[t._v("表要有注释")]),t._v(" "),v("td",[t._v("check_table_comment")])]),t._v(" "),v("tr",[v("td",[t._v("至少有一个列")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("表必须包含某些列")]),t._v(" "),v("td",[t._v("must_have_columns")])]),t._v(" "),v("tr",[v("td",[t._v("表注释长度不能溢出")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("不允许create table as 语法")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("禁止使用Foreign key")]),t._v(" "),v("td",[t._v("enable_foreign_key")])])])]),t._v(" "),v("h4",{attrs:{id:"列属性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#列属性"}},[t._v("#")]),t._v(" 列属性")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("不能设置列的字符集")]),t._v(" "),v("td",[t._v("enable_column_charset")])]),t._v(" "),v("tr",[v("td",[t._v("列的类型不能使用集合、枚举、位图类型")]),t._v(" "),v("td",[t._v("enable_enum_set_bit")])]),t._v(" "),v("tr",[v("td",[t._v("列必须要有注释")]),t._v(" "),v("td",[t._v("check_column_comment")])]),t._v(" "),v("tr",[v("td",[t._v("char长度大于20的时候需要改为varchar（长度可配置）")]),t._v(" "),v("td",[t._v("max_char_length")])]),t._v(" "),v("tr",[v("td",[t._v("列的类型不能是BLOB/TEXT")]),t._v(" "),v("td",[t._v("enable_blob_type")])]),t._v(" "),v("tr",[v("td",[t._v("列的类型不能是JSON")]),t._v(" "),v("td",[t._v("enable_json_type")])]),t._v(" "),v("tr",[v("td",[t._v("不能有重复的列名")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("非数值列不能使用自增")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("不允许无效库名/表名前缀")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("每个列都使用not null")]),t._v(" "),v("td",[t._v("enable_nullable")])]),t._v(" "),v("tr",[v("td",[t._v("是否允许timestamp类型")]),t._v(" "),v("td",[t._v("enable_timestamp_type")])]),t._v(" "),v("tr",[v("td",[t._v("如果是timestamp类型的，则要必须指定默认值。")]),t._v(" "),v("td",[t._v("check_timestamp_default")])]),t._v(" "),v("tr",[v("td",[t._v("如果是datetime类型的，则要必须指定默认值。")]),t._v(" "),v("td",[t._v("check_datetime_default")])]),t._v(" "),v("tr",[v("td",[t._v("不能同时有两个timestamp类型的列，如果是datetime类型，则不能有两个指定DEFAULT CURRENT_TIMESTAMP及ON UPDATE CURRENT_TIMESTAMP的列。")]),t._v(" "),v("td",[t._v("check_timestamp_count,check_datetime_count")])]),t._v(" "),v("tr",[v("td",[t._v("只有timestamp或datatime才能指定on update")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("on update表达式只能为CURRENT_TIMESTAMP")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("建议将 float/double 转成 decimal")]),t._v(" "),v("td",[t._v("check_float_double")])])])]),t._v(" "),v("h4",{attrs:{id:"索引属性检查项"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#索引属性检查项"}},[t._v("#")]),t._v(" 索引属性检查项")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("索引必须要有名字")]),t._v(" "),v("td",[t._v("enable_null_index_name")])]),t._v(" "),v("tr",[v("td",[t._v("Unique索引必须要以uniq_为前缀")]),t._v(" "),v("td",[t._v("check_index_prefix")])]),t._v(" "),v("tr",[v("td",[t._v("普通索引必须要以idx_为前缀")]),t._v(" "),v("td",[t._v("check_index_prefix")])]),t._v(" "),v("tr",[v("td",[t._v("索引的列数不能超过5个")]),t._v(" "),v("td",[t._v("max_key_parts")])]),t._v(" "),v("tr",[v("td",[t._v("主键索引列数限制")]),t._v(" "),v("td",[t._v("max_primary_key_parts")])]),t._v(" "),v("tr",[v("td",[t._v("主键列必须使用int或bigint")]),t._v(" "),v("td",[t._v("enable_pk_columns_only_int")])]),t._v(" "),v("tr",[v("td",[t._v("最多有5个索引")]),t._v(" "),v("td",[t._v("max_keys")])]),t._v(" "),v("tr",[v("td",[t._v("建索引时，指定的列必须存在。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("索引中的列，不能重复")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("BLOB列不能建做KEY")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("索引长度不能超过767或3072,由实际mysql的innodb_large_prefix决定")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("索引名不能是PRIMARY")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("索引名不能重复")]),t._v(" "),v("td")])])]),t._v(" "),v("h4",{attrs:{id:"默认值"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#默认值"}},[t._v("#")]),t._v(" 默认值")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("BLOB/TEXT类型的列，不能有非NULL的默认值")]),t._v(" "),v("td",[t._v("enable_blob_not_null")])]),t._v(" "),v("tr",[v("td",[t._v("如果默认值为NULL，但列类型为NOT NULL，或者是主键列，或者定义为自增列，则报错。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("JSON列不能设置默认值。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("每个列都需要定义默认值，除了自增列/主键/JSON/计算列/以及大字段列之外")]),t._v(" "),v("td",[t._v("check_column_default_value")])])])]),t._v(" "),v("h4",{attrs:{id:"自增列"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#自增列"}},[t._v("#")]),t._v(" 自增列")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("建表时，自增列初始值为1")]),t._v(" "),v("td",[t._v("check_autoincrement_init_value")])]),t._v(" "),v("tr",[v("td",[t._v("如果自增列的名字不为id，说明可能是有意义的，不建议")]),t._v(" "),v("td",[t._v("check_autoincrement_name")])]),t._v(" "),v("tr",[v("td",[t._v("自增列类型必须为int或bigint")]),t._v(" "),v("td",[t._v("check_autoincrement_datatype")])]),t._v(" "),v("tr",[v("td",[t._v("自增列需要设置无符号")]),t._v(" "),v("td",[t._v("enable_autoincrement_unsigned")])])])]),t._v(" "),v("h3",{attrs:{id:"alter"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#alter"}},[t._v("#")]),t._v(" ALTER")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("创建索引")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[t._v("添加字段")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[t._v("默认值")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[t._v("检查字符集")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[t._v("检查排序规则")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[t._v("检查存储引擎")]),t._v(" "),v("td",[t._v("同建表")])]),t._v(" "),v("tr",[v("td",[v("center",[t._v("-")])],1),t._v(" "),v("td",[v("center",[t._v("-")])],1)]),t._v(" "),v("tr",[v("td",[t._v("表是否存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("同一个表的多个ALTER建议合并")]),t._v(" "),v("td",[t._v("merge_alter_table")])]),t._v(" "),v("tr",[v("td",[t._v("列是否存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("表属性只支持对存储引擎、表注释、自增值及默认字符集的修改操作。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("是否允许change column操作")]),t._v(" "),v("td",[t._v("enable_change_column")])]),t._v(" "),v("tr",[v("td",[t._v("是否允许列顺序变更")]),t._v(" "),v("td",[t._v("check_column_position_change")])]),t._v(" "),v("tr",[v("td",[t._v("是否允许列类型变更")]),t._v(" "),v("td",[t._v("check_column_type_change")])])])]),t._v(" "),v("h2",{attrs:{id:"dml"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dml"}},[t._v("#")]),t._v(" DML")]),t._v(" "),v("h3",{attrs:{id:"insert"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#insert"}},[t._v("#")]),t._v(" INSERT")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("表是否存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("列必须存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("必须指定插入列表，也就是要写入哪些列，如insert into t (id,id2) values(...)")]),t._v(" "),v("td",[t._v("check_insert_field")])]),t._v(" "),v("tr",[v("td",[t._v("必须指定值列表。")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("插入列列表与值列表个数相同")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("不为null的列，如果插入的值是null，报错")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("插入指定的列列表中，同一个列不能出现多次。")]),t._v(" "),v("td")])])]),t._v(" "),v("h3",{attrs:{id:"insert-select"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#insert-select"}},[t._v("#")]),t._v(" INSERT SELECT")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("涉及的所有库/表/字段必须存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("必须指定插入列表，也就是要写入哪些列，如insert into t (id,id2) select ...")]),t._v(" "),v("td",[t._v("check_insert_field")])]),t._v(" "),v("tr",[v("td",[t._v("是否允许select *")]),t._v(" "),v("td",[t._v("enable_select_star")])]),t._v(" "),v("tr",[v("td",[t._v("必须有where条件")]),t._v(" "),v("td",[t._v("check_dml_where")])]),t._v(" "),v("tr",[v("td",[t._v("不能有limit条件")]),t._v(" "),v("td",[t._v("check_dml_limit")])]),t._v(" "),v("tr",[v("td",[t._v("不能有order by rand子句")]),t._v(" "),v("td",[t._v("enable_orderby_rand")])]),t._v(" "),v("tr",[v("td",[t._v("使用explain获取预估行数或select count获取真实行数")]),t._v(" "),v("td",[t._v("调用选项"),v("code",[t._v("real_row_count")]),t._v(",explain_rule")])])])]),t._v(" "),v("h3",{attrs:{id:"update-delete"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#update-delete"}},[t._v("#")]),t._v(" UPDATE/DELETE")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",[t._v("检查项")]),t._v(" "),v("th",[t._v("相关配置项")])])]),t._v(" "),v("tbody",[v("tr",[v("td",[t._v("表必须存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("必须有where条件")]),t._v(" "),v("td",[t._v("check_dml_where")])]),t._v(" "),v("tr",[v("td",[t._v("不能有limit条件")]),t._v(" "),v("td",[t._v("check_dml_limit")])]),t._v(" "),v("tr",[v("td",[t._v("不能有order by语句")]),t._v(" "),v("td",[t._v("check_dml_orderby")])]),t._v(" "),v("tr",[v("td",[t._v("影响行数大于10000条，则报警（数目可配置）")]),t._v(" "),v("td",[t._v("max_update_rows")])]),t._v(" "),v("tr",[v("td",[t._v("对WHERE条件这个表达式做简单检查，具体包括什么不一一指定")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("多表更新、删除时，每个表及涉及字段必须要存在")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("限制一条insert values的总行数")]),t._v(" "),v("td",[t._v("max_insert_rows")])]),t._v(" "),v("tr",[v("td",[t._v("update 多表关联时,如果set未指定表前缀,自动判断")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("多表时判断未指明表前缀的列是否有歧义")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("update多表关联时,如果set了多个表的字段,同样支持回滚语句生成")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("使用explain获取预估行数或select count获取真实行数")]),t._v(" "),v("td",[t._v("调用选项"),v("code",[t._v("realRowCount")]),t._v(",explain_rule")])]),t._v(" "),v("tr",[v("td",[t._v("mysql版本在5.6之前时,自动将语句转换为select做explain")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",[t._v("设置数据库"),v("code",[t._v("sql_safe_updates")]),t._v("参数")]),t._v(" "),v("td",[t._v("sql_safe_updates")])]),t._v(" "),v("tr",[v("td",[t._v("多表关联时,审核join语句是否包含on子句")]),t._v(" "),v("td",[t._v("check_dml_where")])]),t._v(" "),v("tr",[v("td",[t._v("条件中的列是否存在隐式类型转换")]),t._v(" "),v("td",[t._v("check_implicit_type_conversion")])]),t._v(" "),v("tr",[v("td",[t._v("update set 判断set使用了逗号还是and分隔")]),t._v(" "),v("td")])])]),t._v(" "),v("h1",{attrs:{id:"说明"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),v("ul",[v("li",[t._v("SQL审核主要针对mysql 5.7版本，其他版本支持会有通用的支持，但细节处可能会有差异，如果有什么问题，欢迎提交"),v("a",{attrs:{href:"https://github.com/hanchuanchuan/goInception/issues",target:"_blank",rel:"noopener noreferrer"}},[t._v("Issues"),v("OutboundLink")],1),t._v("来共同建设。")])])])}),[],!1,null,null,null);_.default=d.exports}}]);