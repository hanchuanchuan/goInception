(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{445:function(t,a,s){"use strict";s.r(a);var n=s(44),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"统计功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#统计功能"}},[t._v("#")]),t._v(" 统计功能")]),t._v(" "),s("p",[t._v("统计功能用以记录操作占比，通过参数 "),s("code",[t._v("enable_sql_statistic")]),t._v(" 开启。")]),t._v(" "),s("p",[t._v("除了上面的参数之外，使用这个功能还需要开启操作备份功能，因为这些统计数据需要存储到备份数据库中，存储的数据库名为inception中，\n这个数据库现在只有一个表statistic，存储的就是SQL执行数目的统计数据。")]),t._v(" "),s("p",[s("strong",[t._v("statistic")]),t._v("表的结构如下：\n"),s("img",{attrs:{src:"images/statistic.png",alt:""}})]),t._v(" "),s("p",[t._v("从每一个列的名字就可以看到，其值对应的操作是什么，每一个列就是一个自增列，第二个列optime是操作时间，这个主要是用来统计在某一段时间内的某一个操作占多少比例。")]),t._v(" "),s("p",[t._v("部分列说明：")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("deleting")]),t._v(" : 包括普通的删除操作及多表删除操作。")]),t._v(" "),s("li",[s("strong",[t._v("inserting")]),t._v(" : 包括单行插入、多行插入及查询插入。")]),t._v(" "),s("li",[s("strong",[t._v("updating")]),t._v(" : 包括普通单表更新及多表的更新。")]),t._v(" "),s("li",[s("strong",[t._v("renaming")]),t._v(" : 指的是ALTER table语句中的rename操作。")]),t._v(" "),s("li",[s("strong",[t._v("createindex")]),t._v(" : 指的是ALTER table语句中的add index操作。")]),t._v(" "),s("li",[s("strong",[t._v("dropindex")]),t._v(" : 指的是ALTER table语句中的drop index操作。")]),t._v(" "),s("li",[s("strong",[t._v("alteroption")]),t._v(" : 指的是ALTER table语句中的修改表属性的操作，比如存储引擎、自增值及字符集中操作。")]),t._v(" "),s("li",[s("strong",[t._v("alterconvert")]),t._v(" : 指的是ALTER table语句中修改表字符集的操作。")])]),t._v(" "),s("p",[t._v("对于ALTER TABLE操作，因为这个操作包含很多的子操作，比如rename、drop index、engine innodb等操作，所以对于列altertable，它的值是renaming, createindex, dropindex, addcolumn, dropcolumn, changecolumn, alteroption, alterconvert的和, 而后面的是对ALTER TABLE语句的细分操作统计。")]),t._v(" "),s("p",[t._v("那么如果现在想要统计某一个操作，比如修改表占所有操作的百分比，则使用如下语句即可完成：")]),t._v(" "),s("div",{staticClass:"language-sql extra-class"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Sum")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oprate"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Count")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" updaterate\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" updating "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" usedb "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" deleting "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" inserting "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" updating "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                                selecting\n                                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" altertable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" createtable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" droptable "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("\n                                createdb\n                                "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" truncating "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" oprate\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v("   inception"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("statistic"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" a"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h1",{attrs:{id:"说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[t._v("#")]),t._v(" 说明")]),t._v(" "),s("ul",[s("li",[t._v("只是审核操作，或者审核失败未执行时，不会进行操作统计。")]),t._v(" "),s("li",[t._v("goInception会记录实际执行的数据，即如果执行一部分后失败时，只记录实际执行的操作。")]),t._v(" "),s("li",[t._v("备份出错导致提前返回时，不会影响统计信息。")])])])}),[],!1,null,null,null);a.default=e.exports}}]);